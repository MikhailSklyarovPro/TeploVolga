# Модуль управления свайпом карточек новостей

## Описание

Модуль `swipe.js` реализует функциональность навигации по карточкам новостей с помощью кнопок управления. Обеспечивает плавную прокрутку, адаптивность при изменении размера окна и корректное отображение состояний кнопок.

## Основные возможности

- **Навигация по карточкам**: Переключение между карточками с помощью кнопок "назад" и "вперед"
- **Плавная прокрутка**: Анимированное перемещение к следующей/предыдущей карточке
- **Адаптивность**: Автоматический перерасчет позиции при изменении размера окна
- **Умные кнопки**: Блокировка кнопок на основе реальной видимости карточек, а не индекса
- **Точное позиционирование**: Карточки всегда прилипают к левому краю контейнера
- **Отслеживание скролла**: Реальное отслеживание позиции скролла для корректного определения состояния

## Структура HTML

Для корректной работы модуля необходимо наличие следующих элементов:

```html
<!-- Контейнер с карточками -->
<div class="cards-news" data-swipe data-infinite-swipe>
  <a href="#" class="card-swipe">
    <!-- Содержимое карточки -->
  </a>
  <!-- Другие карточки -->
</div>

<!-- Кнопки управления -->
<button class="home__news-title__controls__arrow" data-swipe-prev>
  <!-- SVG иконка -->
</button>
<button class="home__news-title__controls__arrow" data-swipe-next>
  <!-- SVG иконка -->
</button>
```

## API класса NewsSwipeController

### Конструктор

```javascript
new NewsSwipeController();
```

Автоматически инициализирует контроллер при загрузке DOM.

### Основные методы

#### `scrollToPrevious()`

Перемещает к предыдущей карточке. Блокируется если текущая карточка - первая.

#### `scrollToNext()`

Перемещает к следующей карточке. Блокируется если текущая карточка - последняя.

#### `scrollToCard(index, smooth = true)`

Перемещает к карточке с указанным индексом.

- `index` - индекс целевой карточки (0-based)
- `smooth` - использовать ли плавную анимацию (по умолчанию true)

#### `handleResize()`

Обрабатывает изменение размера окна. Пересчитывает позицию карточек для корректного отображения.

#### `updateButtonStates()`

Обновляет состояние кнопок навигации на основе реальной позиции скролла:

- Блокирует кнопку "назад" когда достигнут левый край контейнера
- Блокирует кнопку "вперед" когда все карточки видны (достигнут правый край)
- Изменяет цвет иконок на серый для заблокированных кнопок

### Вспомогательные методы

#### `getCardWidth()`

Возвращает ширину карточки в пикселях.

#### `getGap()`

Возвращает значение gap между карточками в пикселях. Поддерживает различные единицы измерения (px, rem).

#### `isAtStart()`

Проверяет, достигнут ли левый край контейнера (scrollLeft <= 0).

#### `isAtEnd()`

Проверяет, достигнут ли правый край контейнера (все карточки видны).

#### `updateCurrentIndexFromScroll()`

Обновляет текущий индекс на основе реальной позиции скролла.

#### `handleScroll()`

Обрабатывает события скролла и обновляет состояние кнопок.

## Алгоритм работы

### 1. Расчет позиции скролла

```javascript
const scrollPosition = index * (cardWidth + gap);
```

Позиция рассчитывается как произведение индекса карточки на сумму ширины карточки и gap между ними.

### 2. Обработка ресайза

При изменении размера окна:

1. Очищается предыдущий таймер дебаунса
2. Устанавливается новый таймер на 100мс
3. Выполняется перерасчет позиции без анимации
4. Обновляется состояние кнопок

### 3. Управление состояниями кнопок

- **Активное состояние**: `opacity: 1`, цвет иконки `#FD5D39`
- **Заблокированное состояние**: `opacity: 0.5`, цвет иконки `#9CA3AF`

### 4. Отслеживание скролла

Модуль отслеживает реальную позицию скролла и обновляет состояние кнопок:

- При скролле влево до начала - блокируется кнопка "назад"
- При скролле вправо до конца (все карточки видны) - блокируется кнопка "вперед"
- Индекс карточки пересчитывается на основе позиции скролла

## CSS зависимости

Модуль работает с существующими CSS стилями:

```css
.cards-news {
  display: flex;
  gap: 20px;
  overflow-x: auto;
  scrollbar-width: none;
}

.card-swipe {
  flex-shrink: 0;
}
```

## Обработка ошибок

Модуль включает проверки на существование необходимых элементов:

- Контейнер с атрибутом `data-swipe`
- Кнопки с атрибутами `data-swipe-prev` и `data-swipe-next`
- Карточки с классом `card-swipe`

При отсутствии элементов выводится предупреждение в консоль.

## Производительность

- **Дебаунс для ресайза**: Предотвращает избыточные вычисления при изменении размера окна
- **Флаг переходов**: Блокирует множественные клики во время анимации
- **Оптимизированные вычисления**: Кэширование размеров элементов

## Совместимость

- Поддерживает все современные браузеры
- Работает с различными единицами измерения CSS (px, rem, em)
- Адаптивен к изменениям в DOM структуре
