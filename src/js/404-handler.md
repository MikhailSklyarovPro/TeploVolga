# Обработчик 404 ошибок

## Описание

Система автоматической обработки 404 ошибок для вашего проекта. Когда пользователь вводит несуществующий путь, он автоматически перенаправляется на страницу `error.html`.

## Что было реализовано

Модуль `404-handler.js` автоматически проверяет существование текущей страницы и перенаправляет пользователя на страницу ошибки (`error.html`), если запрошенная страница не существует.

## Как это работает

### 1. Автоматическая генерация маршрутов

При запуске dev сервера (`npm run dev`) или сборке проекта (`npm run build`), файл `vite.config.js` автоматически:
- Находит все HTML файлы в проекте
- Генерирует файл `src/js/routes.js` со списком всех доступных страниц

### 2. Проверка на клиенте

Модуль `404-handler.js` проверяет каждый запрос:
- Если страница существует в списке маршрутов → всё работает как обычно
- Если страница не найдена → автоматический редирект на `pages/error.html`

### 3. Middleware для dev сервера

В режиме разработки Vite middleware также проверяет существование файлов на сервере и перенаправляет на `error.html` при необходимости.

### 4. Защита от зацикливания

Скрипт не выполняется на самой странице `error.html`, чтобы избежать бесконечных редиректов.

## Файлы

- `src/js/routes.js` - автоматически генерируемый список маршрутов (не редактировать вручную!)
- `src/js/404-handler.js` - основной модуль обработки 404
- `vite.config.js` - конфигурация с автоматической генерацией маршрутов и middleware
- `scripts/add-404-handler.js` - скрипт для добавления обработчика во все HTML файлы

## Использование

### Первоначальная настройка (уже выполнено)

Скрипт `404-handler.js` уже добавлен во все HTML файлы проекта. Если вы добавите новые HTML файлы, выполните:

```bash
npm run add-404-handler
```

Или используйте скрипт напрямую:

```bash
node scripts/add-404-handler.js
```

### Ручное подключение

Добавьте следующий тег в секцию `<head>` каждого HTML файла (кроме `error.html`):

**Для файлов в корне `src/` (например, `index.html`):**

```html
<script type="module" src="./js/404-handler.js"></script>
```

**Для файлов в `src/pages/` (например, `pages/home/news.html`):**

```html
<script type="module" src="../../js/404-handler.js"></script>
```

**Для файлов в `src/pages/subfolder/` (например, `pages/heating-networks/index.html`):**

```html
<script type="module" src="../../js/404-handler.js"></script>
```

### Проверка работы

1. Запустите dev сервер:
   ```bash
   npm run dev
   ```

2. Откройте браузер и перейдите на несуществующую страницу:
   ```
   http://localhost:5173/pages/nonexistent-page.html
   ```

3. Вы должны быть автоматически перенаправлены на:
   ```
   http://localhost:5173/pages/error.html
   ```

## Добавление новых страниц

При добавлении новых HTML страниц:

1. Создайте новый HTML файл в нужной директории
2. При следующем запуске `npm run dev` или `npm run build`, список маршрутов обновится автоматически
3. Если нужно, добавьте `404-handler.js` в новый файл:
   ```bash
   npm run add-404-handler
   ```

## Настройка

### Изменение пути к странице ошибки

Если нужно изменить путь к `error.html`, отредактируйте `src/js/404-handler.js`:

```javascript
// Строка 48
let errorPath = './pages/error.html'; // измените на нужный путь
```

### Исключение страниц из проверки

Если нужно исключить определенные страницы, отредактируйте `src/js/404-handler.js`:

```javascript
// В функции checkPageExists()
function checkPageExists() {
  const currentPath = getCurrentPath();
  const normalizedPath = normalizePath(currentPath);

  // Добавить исключения
  if (normalizedPath === 'pages/special-page.html') {
    return; // Не проверяем эту страницу
  }

  // ... остальной код
}
```

## Особенности

- ✅ Работает как в dev режиме (через Vite middleware), так и в production (через JavaScript)
- ✅ Автоматически обновляет список маршрутов при добавлении новых страниц
- ✅ Не требует ручного обновления списка путей
- ✅ Защита от зацикливания на странице ошибки
- ✅ Сохраняет оригинальный URL в sessionStorage для возможного использования

## Важные замечания

- ✅ Файл `routes.js` генерируется автоматически - **не редактируйте его вручную**
- ✅ Скрипт не выполняется на самой странице `error.html` (защита от зацикливания)
- ✅ Работает как в dev режиме, так и в production
- ✅ При добавлении новых HTML файлов список маршрутов обновляется автоматически
- ✅ Middleware в `vite.config.js` работает только в dev режиме, в production используется JavaScript проверка

## Отладка

Если редирект не работает:

1. Проверьте консоль браузера (F12) на наличие ошибок
2. Убедитесь, что `404-handler.js` подключен в HTML файле
3. Проверьте, что файл `routes.js` существует и содержит нужный путь
4. Убедитесь, что путь к `error.html` указан правильно
5. Проверьте, что путь к `error.html` указан правильно

## Примечания

- Файл `routes.js` генерируется автоматически - не редактируйте его вручную
- При добавлении новых HTML страниц, список маршрутов обновится автоматически при следующем запуске dev сервера или сборке
- Middleware в `vite.config.js` работает только в dev режиме, в production используется JavaScript проверка
